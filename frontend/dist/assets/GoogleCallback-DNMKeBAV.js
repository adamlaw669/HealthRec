import{e as x,u as k,b as h,j as e,i as b}from"./index-TQdBg8Zg.js";const v=({error:a,logs:n})=>a?e.jsxs("div",{className:"mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded text-xs font-mono max-h-[30vh] overflow-auto",children:[e.jsxs("h3",{className:"text-red-500 mb-2",children:["Error: ",a]}),n.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-gray-700 dark:text-gray-300 mb-1",children:"Debug logs:"}),n.map((c,l)=>e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:c},l))]})]}):null,p=()=>{const[a]=x(),n=k(),[c,l]=h.useState(null),[m,u]=h.useState([]),r=d=>{console.log(d),u(o=>[...o,d])};return h.useEffect(()=>{(async()=>{try{const o=a.get("token"),g=a.get("refresh");if(r(`Checking for tokens in URL: token=${!!o}, refresh=${!!g}`),r(`URL params: ${JSON.stringify(Object.fromEntries(a.entries()))}`),o&&g){r("Tokens found in URL, storing directly");try{localStorage.removeItem("token"),localStorage.removeItem("refresh"),localStorage.setItem("token",o),localStorage.setItem("refresh",g);const s=localStorage.getItem("token"),f=localStorage.getItem("refresh");if(!s||!f)throw new Error("Failed to store tokens in localStorage");r("Authentication successful via redirect with tokens"),setTimeout(()=>{n("/dashboard")},500);return}catch(s){r(`LocalStorage error: ${s.message}`)}}const i=a.get("code");if(r(`Authorization code present: ${!!i}`),!i)throw new Error("No authorization code or tokens received");r(`Exchanging code for token: ${i.substring(0,10)}...`);const t=await b(i);if(r(`Response received with keys: ${Object.keys(t).join(", ")}`),t.token){r("Token found in response, storing tokens");try{if(localStorage.removeItem("token"),localStorage.removeItem("refresh"),localStorage.setItem("token",t.token),t.refresh&&localStorage.setItem("refresh",t.refresh),!localStorage.getItem("token"))throw new Error("Failed to store token in localStorage");r("Authentication successful via code exchange"),setTimeout(()=>{n("/dashboard")},500)}catch(s){throw new Error(`LocalStorage error: ${s.message}`)}}else if(t.redirected&&t.location)r(`Received redirect to: ${t.location}`),window.location.href=t.location;else{const s=t.error||t.message||"Invalid response format";throw r(`Error in response: ${s}`),new Error(s)}}catch(o){console.error("Google callback error:",o),l(o.message||"Authentication failed"),r(`Error during authentication: ${o.message}`),setTimeout(()=>{n("/auth?mode=signin&error=google_login_failed")},5e3)}})()},[a,n]),e.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen p-4",children:e.jsxs("div",{className:"text-center",children:[!c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-300",children:"Processing login..."})]}),c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-red-500 text-xl mb-4",children:"Authentication Failed"}),e.jsx("p",{className:"mb-4",children:"Redirecting to login page in a few seconds..."}),e.jsx("button",{onClick:()=>n("/auth?mode=signin"),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Return to Login"})]}),e.jsx(v,{error:c,logs:m})]})})};export{p as default};
//# sourceMappingURL=GoogleCallback-DNMKeBAV.js.map
