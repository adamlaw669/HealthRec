import{u as S,e as v,b as m,j as r,i as j}from"./index-TQdBg8Zg.js";const x=({logs:t})=>!t||t.length===0?null:r.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-gray-800 text-green-400 p-4 max-h-[30vh] overflow-auto text-xs font-mono",children:[r.jsxs("div",{className:"flex justify-between mb-2",children:[r.jsx("h3",{className:"text-white",children:"Debug Console"}),r.jsx("button",{className:"text-white",onClick:()=>console.clear(),children:"Clear"})]}),r.jsx("div",{children:t.map((n,f)=>r.jsxs("div",{className:`${n.type==="error"?"text-red-400":"text-green-400"}`,children:[n.time,": ",n.message]},f))})]});function y(){const t=S(),[n]=v(),[f,h]=m.useState(null),[p,a]=m.useState(!0),[u,k]=m.useState([]),o=(d,s="info")=>{const c=new Date().toLocaleTimeString();console.log(`[${c}] ${d}`),k(g=>[...g,{time:c,message:d,type:s}])},i=d=>{const s=new Date().toLocaleTimeString();console.error(`[${s}] ${d}`),k(c=>[...c,{time:s,message:d,type:"error"}])};return m.useEffect(()=>{(async()=>{try{o("Auth callback initiated"),o(`URL params: ${JSON.stringify(Object.fromEntries(n.entries()))}`);const s=n.get("token"),c=n.get("refresh");if(s&&c){o("Token found in URL, storing and redirecting");try{localStorage.setItem("token",s),localStorage.setItem("refresh",c);const e=localStorage.getItem("token"),l=localStorage.getItem("refresh");if(o(`Token storage verification - token: ${e?"Success":"Failed"}, refresh: ${l?"Success":"Failed"}`),!e||!l)throw i("Failed to store tokens in localStorage"),new Error("Token storage failed");o("Authentication successful via redirect"),a(!1),t("/dashboard");return}catch(e){i(`LocalStorage error: ${e instanceof Error?e.message:"Unknown error"}`)}}const g=n.get("code");if(o(`Authorization code present: ${!!g}`),!g){i("No code or tokens received in callback"),h("No authorization code received"),a(!1),t("/?mode=signin&error=google_login_failed");return}o(`Exchanging code for token: ${g.substring(0,10)}...`);try{const e=await j(g);if(o(`Received user data response: ${JSON.stringify(e)}`),e&&e.token){o("Storing tokens from response");try{localStorage.setItem("token",e.token),e.refresh&&localStorage.setItem("refresh",e.refresh);const l=localStorage.getItem("token"),b=localStorage.getItem("refresh");o(`Token storage verification - token: ${l?"Success":"Failed"}, refresh: ${b?"Success":"Failed"}`),o("Authentication successful via code exchange"),a(!1),t("/dashboard")}catch(l){i(`LocalStorage error during token storage: ${l instanceof Error?l.message:"Unknown error"}`),h("Failed to store authentication tokens"),a(!1),t("/?mode=signin&error=storage_failed")}}else e&&e.redirected?(o("Redirect handled by googleCallback function"),a(!1)):(i(`Authentication failed: Invalid response format: ${JSON.stringify(e)}`),h("Invalid response format from server"),a(!1),t("/?mode=signin&error=google_login_failed"))}catch(e){throw i(`Error in googleCallback: ${e instanceof Error?e.message:"Unknown error"}`),e}}catch(s){i(`Error during authentication: ${s instanceof Error?s.message:"Unknown error"}`),h(s instanceof Error?s.message:"Unknown error"),a(!1),t("/?mode=signin&error=google_login_failed")}})()},[n,t]),f?r.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen",children:[r.jsxs("div",{className:"text-red-500 mb-4",children:["Error: ",f]}),r.jsx("button",{onClick:()=>t("/"),className:"px-4 py-2 bg-primary text-white rounded",children:"Return to Login"}),r.jsx(x,{logs:u})]}):r.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen",children:[r.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"}),r.jsx("div",{className:"mt-4",children:"Processing authentication..."}),r.jsx(x,{logs:u})]})}export{y as default};
//# sourceMappingURL=page-BBhsJLiS.js.map
