import{f as U,u as L,b as s,c as R,j as e,t as I,d as b,h as M}from"./index-DTXh_tpA.js";import{F as A,a as O,v as T,w as H}from"./index-DrrU2QEE.js";import{S as Y}from"./Sidebar-B2qVLPki.js";function _(){const{isSidebarOpen:j}=U(),n=L(),[o,u]=s.useState({email:"",name:"",profilePicture:"/images/dark_blue.jpg"}),[m,i]=s.useState(!0),[v,g]=s.useState(!1),[d,h]=s.useState({name:""}),[f,p]=s.useState(!1),[c,k]=s.useState("json"),[y,w]=s.useState(!1),x=s.useRef(null);s.useEffect(()=>{const r=R();p(r)},[]);const N=()=>{const r=I(f);p(r)};s.useEffect(()=>{(async()=>{i(!0);try{const a=await b.getProfile();a&&(u({email:a.email||"",name:a.name||"User",profilePicture:a.profilePicture||"/images/dark_blue.jpg"}),h({name:a.name||"User"}))}catch(a){console.error("Error fetching user data:",a),(a instanceof Error?a.message:"Unknown").toString().includes("401")&&n("/auth?mode=signin")}finally{i(!1)}})()},[n]);const S=r=>{const{name:a,value:t}=r.target;h({...d,[a]:t})},C=async r=>{r.preventDefault(),i(!0);try{const a=await b.updateProfile({name:d.name});if(a&&a.success)u(t=>({...t,name:d.name})),g(!1),alert(a.message||"Profile updated successfully!");else throw new Error((a==null?void 0:a.message)||"Failed to update profile")}catch(a){console.error("Error updating profile:",a),alert(a instanceof Error?a.message:"Failed to update profile. Please try again.")}finally{i(!1)}},D=()=>{x.current&&x.current.click()},P=r=>{if(r.target.files&&r.target.files[0]){const a=new FileReader;a.onload=t=>{t.target&&t.target.result&&u({...o,profilePicture:t.target.result.toString()})},a.readAsDataURL(r.target.files[0])}},F=async()=>{w(!0);try{const r=await M.downloadHealthData(c),a=new Blob([r],{type:c==="json"?"application/json":"text/csv"}),t=window.URL.createObjectURL(a),l=document.createElement("a");l.href=t,l.download=`health-data.${c}`,document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(t),document.body.removeChild(l)}catch(r){console.error("Error downloading data:",r)}finally{w(!1)}},E=async()=>{try{await b.logout()}catch(r){console.error("Error during logout:",r)}finally{localStorage.clear(),n("/")}};return e.jsxs("div",{className:"flex min-h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(Y,{}),e.jsx("main",{className:`flex-1 transition-all duration-300 ${j?"ml-64":"ml-20"} p-6 overflow-auto`,children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"Profile"}),e.jsx("button",{onClick:N,className:"p-2 bg-blue-600 hover:bg-blue-700 text-white rounded-full transition-colors","aria-label":f?"Switch to light mode":"Switch to dark mode",children:f?e.jsx(A,{className:"h-5 w-5"}):e.jsx(O,{className:"h-5 w-5"})})]}),m?e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-600"})})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start space-y-4 md:space-y-0 md:space-x-6",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"w-32 h-32 rounded-full overflow-hidden border-4 border-blue-600 dark:border-blue-500 cursor-pointer",onClick:D,children:[e.jsx("img",{src:o.profilePicture||"/placeholder.svg?height=200&width=200",alt:"Profile",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-30 flex items-center justify-center transition-all duration-200",children:e.jsx(T,{className:"text-white opacity-0 hover:opacity-100 text-2xl"})})]}),e.jsx("input",{type:"file",ref:x,className:"hidden",accept:"image/*",onChange:P})]}),e.jsx("div",{className:"flex-1 text-center md:text-left",children:v?e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name"}),e.jsx("input",{type:"text",id:"name",name:"name",value:d.name,onChange:S,className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",required:!0})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{type:"submit",disabled:m,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:m?"Saving...":"Save Changes"}),e.jsx("button",{type:"button",onClick:()=>{g(!1),h({name:o.name})},className:"px-4 py-2 bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2",children:"Cancel"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:o.name}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:o.email})]}),e.jsx("button",{onClick:()=>g(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:"Edit Profile"})]})})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6 border border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-white mb-4",children:"Download Your Health Data"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"You can download all your health data in various formats for your records or to share with healthcare providers. Your data is encrypted and secure."}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center space-y-3 sm:space-y-0 sm:space-x-3",children:[e.jsxs("select",{value:c,onChange:r=>k(r.target.value),className:"w-full sm:w-auto p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"json",children:"JSON Format"}),e.jsx("option",{value:"csv",children:"CSV Format"})]}),e.jsx("button",{onClick:F,disabled:y,className:"w-full sm:w-auto flex items-center justify-center px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition disabled:bg-blue-400 disabled:cursor-not-allowed",children:y?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Downloading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"mr-2"}),"Download Data"]})})]})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:E,className:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition",children:"Logout"}),e.jsx("button",{onClick:()=>n("/settings"),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition",children:"Settings"})]})]})]})})]})}export{_ as default};
//# sourceMappingURL=ProfilePage-BjgSBIBA.js.map
